import 'dart:async';
import 'dart:convert';

import '../../../services/network/rest_services.dart';
<% for (i in entities) { %>
import '../models/<%= entities[i].entityInstance %>.dart'; <%}%>

class <%= capitalize(appsName) %>Services { 
<% for (i in paths) { %>
<% for (m in paths[i].methods) { 
  const path = paths[i].path;
  const requestType = paths[i].methods[m].requestBodyType;
  const requestClass = capitalize(requestType);
  const requestBodyClass = capitalize(requestType); 
  const responseClass = capitalize(paths[i].methods[m].responseType); 
  const methodName = paths[i].methods[m].operationId;
  const isInput = requestType?true:false;
  const methodPath = validatePath(paths[i].methods[m].method);
  const desc = paths[i].methods[m].description; 
  const summary = paths[i].methods[m].summary;
  const parameters = putParam(paths[i].methods[m]);

%>
  /**
  * <%= summary %><% if(desc){%>
  * <%= desc %> <%}%>
  */
  static Future<<%= responseClass %>> <%= methodName %>(<%= parameters %>) async {
    var response = await RestServices.<%= methodPath %>('<%= path %>'); 
    <%if(isInput){%>return <%= requestBodyClass %>.fromJson(json.decode(response));<%}%>
  }
<% } } %>
}

<%

function putParam(input){
  let result = '';
  let param = input.parameters;
  let addComma = '';
  
  if(param){
    if(param.length>0)
      addComma = ', '

    let n = param.length
    let comma =''
    for(p in param){
      result += comma + capitalize(param[p].schema.type)+' '+param[p].name ;
      n--;
      if(n>0)
        comma =', '
    } 
  }
  

  if(input.requestBodyType)
    result += addComma+capitalize(input.requestBodyType)+' '+input.requestBodyType;
  
  return result;
}

function capitalize(text){
  if(text)
    return text.substr( 0, 1 ).toUpperCase()+text.substr( 1 );
  else ''
}

function validatePath(m){
  let method = m;
  if(m == 'put')
    method = 'update';
  else if (m == 'get')
    method = 'fetch';

  return method;
}
%>